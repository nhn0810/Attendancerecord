# 다음 대화창을 위한 작업 명세서 (기능 요구사항 정리)

현재 프로젝트: `c:\Users\rlask\Desktop\recording_system`

## 1. 새친구 출석 기록 보존 로직 개선
* **문제점:** 새친구가 반 배정을 받으면 기존의 '새친구' 태그가 사라지면서, 과거 예배 기록(달력)에서도 새친구 명단에서 사라지거나 출석 현황을 파악하기 힘들어짐.
* **해결 방안:** `students` 데이터베이스 테이블에 날짜 추적용 컬럼 2개(`first_visit_date`, `class_assigned_date`)를 추가하여 과거 상태를 보존.
* **상세 구현 계획:**
  1. **DB 스키마 추가:** `students` 테이블에 `first_visit_date`(최초 등록일, Date)와 `class_assigned_date`(반 배정일, Date) 추가.
  2. **새친구 판별 로직 변경 (`AttendanceCheck.tsx`):** 단순 `tags` 배열 감지가 아니라, **현재 조회 중인 달력의 날짜(D)**를 기준으로 `first_visit_date <= D` 이고 (`class_assigned_date`가 null이거나 `class_assigned_date > D`) 인 경우에만 새친구 목록에 표시.
  3. **반 배정 액션:** 새친구를 특정 반으로 배정할 때, `새친구` 태그를 제거하고 현재 조회 중인 달력 날짜를 `class_assigned_date`로 DB에 저장. 이로써 조회일과 생성일이 같은 날이라면 바로 정규 반에 배치된 것으로 취급하여 새친구 명단에 남지 않음.
  4. **수동 태그 부여 경고:** 수동으로 '새친구' 태그를 달면 "새친구 태그를 부여하면 이전의 출석기록은 사라집니다."라는 경고창을 띄우고, 수락 시 `first_visit_date`를 현재 달력 날짜로 리셋.

## 2. 동명이인 생성 검증 (중복 추가 방지)
* **문제점:** 선생님들이 이미 존재하는 학생임에도 불구하고 검색/확인 없이 계속 새 학생을 생성하는 문제 발생.
* **해결 방안:** 학생 추가 시 기존 DB를 검색하여 동명이인 여부를 묻는 팝업과 자동 이름 꼬리표(A, B, C...) 로직 구현.
* **상세 구현 계획:**
  1. **검증 로직 (`utils/studentUtils.ts`):** `students` 테이블에서 입력된 이름(예: '홍길동') 또는 이름+알파벳(예: '홍길동A')을 검색.
  2. **동명이인 발견 시 팝업:** "중/고-반(ex 3-1) 홍길동이 이미 존재합니다. 동명이인입니까?" (Yes/No)
  3. **알파벳 꼬리표 (A, B, C):** 기존에 '홍길동'만 있었다면 기존 학생을 '홍길동A'로 변경하고 새 학생을 '홍길동B'로 저장. 이미 A, B가 있다면 자동으로 'C' 부여.
  4. **완료 팝업:** "기존 '중등-1반-홍길동'은 '홍길동A'로, 방금 입력하신 이름은 '홍길동B'로 저장되었습니다." 표시 및 확인 버튼.

## 3. 안전한 삭제 (경고 팝업 강화)
* **문제점:** 학생 또는 선생님/간사 삭제 시 실수로 데이터를 날릴 위험. (출석 기록이 Cascade 설정으로 인해 연쇄 삭제됨)
* **해결 방안:** 삭제 버튼(`trash` 아이콘 등) 클릭 시 명확한 경고 문구와 확인/취소 버튼 제공.
* **상세 구현 계획:**
  1. **학생 삭제 (`RosterManager.tsx` 등):** "이름을 삭제하면 출석기록도 함께 삭제되어 되돌릴 수 없습니다. 정말 삭제하시겠습니까?" 팝업 추가.
  2. **교사/간사 삭제 (`StaffCheck.tsx`):** 동일하게 "이름을 삭제하면 출석기록도 함께 삭제되어 되돌릴 수 없습니다. 정말 삭제하시겠습니까?" 팝업 추가.
